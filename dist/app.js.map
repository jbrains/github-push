{"version":3,"sources":["app.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","ComponentManager","permissions","onReady","sentMessages","messageQueue","initialPermissions","loggingEnabled","acceptsThemes","onReadyCallback","coallesedSaving","coallesedSavingDelay","window","addEventListener","event","console","log","data","handleMessage","bind","value","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","callback","requestPermissions","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","postMessage","err","return","environment","uuid","getSelfComponentUUID","isRunningInDesktopApplication","setComponentDataValueForKey","clearComponentData","componentDataValueForKey","push","generateUUID","api","sentMessage","JSON","parse","stringify","parent","setSize","type","width","height","streamItems","contentTypes","Array","isArray","content_types","items","streamContextItem","item","selectItem","jsonObjectForItem","createItem","associateItem","deassociateItem","clearSelection","content_type","deleteItem","deleteItems","params","map","sendCustomEvent","saveItem","saveItems","_this","updated_at","Date","saveBlock","pendingSave","clearTimeout","setTimeout","copy","assign","children","urls","deactivateAllCustomThemes","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","url","link","document","createElement","href","rel","media","className","getElementsByTagName","appendChild","elements","getElementsByClassName","forEach","call","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","toString","d","getTime","performance","now","Math","random","floor","module","exports","angular","HomeCtrl","$rootScope","$scope","$timeout","formData","loading","pushStatus","name","componentManager","defaultHeight","note","repos","loadRepoDataForCurrentNote","token","onTokenSet","submitToken","gh","GitHub","me","getUser","loadingRepos","listRepos","alert","noteData","savedNote","noteFileExtension","fileExtension","noteFileDirectory","fileDirectory","selectRepoWithName","repoName","defaultRepo","hasDefaultRepo","defaultFileExtension","defaultFileDirectory","selectedRepo","repo","didSelectRepo","selectedRepoObject","getRepo","owner","login","setDataForNote","notesData","sanitizeFileDirectory","$directory","pushChanges","$event","blur","commitMessage","content","title","writeFile","text","encode","result","logout","$$ngIsClass","controller"],"mappings":"AAAA;;;;AAEA,IAAIA,eAAe,YAAY;AAAE,WAASC,gBAAT,CAA0BC,MAA1B,EAAkCC,KAAlC,EAAyC;AAAE,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,MAAME,MAA1B,EAAkCD,GAAlC,EAAuC;AAAE,UAAIE,aAAaH,MAAMC,CAAN,CAAjB,CAA2BE,WAAWC,UAAX,GAAwBD,WAAWC,UAAX,IAAyB,KAAjD,CAAwDD,WAAWE,YAAX,GAA0B,IAA1B,CAAgC,IAAI,WAAWF,UAAf,EAA2BA,WAAWG,QAAX,GAAsB,IAAtB,CAA4BC,OAAOC,cAAP,CAAsBT,MAAtB,EAA8BI,WAAWM,GAAzC,EAA8CN,UAA9C;AAA4D;AAAE,GAAC,OAAO,UAAUO,WAAV,EAAuBC,UAAvB,EAAmCC,WAAnC,EAAgD;AAAE,QAAID,UAAJ,EAAgBb,iBAAiBY,YAAYG,SAA7B,EAAwCF,UAAxC,EAAqD,IAAIC,WAAJ,EAAiBd,iBAAiBY,WAAjB,EAA8BE,WAA9B,EAA4C,OAAOF,WAAP;AAAqB,GAAhN;AAAmN,CAA9hB,EAAnB;;AAEA,SAASI,eAAT,CAAyBC,QAAzB,EAAmCL,WAAnC,EAAgD;AAAE,MAAI,EAAEK,oBAAoBL,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIM,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,IAAIC,mBAAmB,YAAY;AACjC,WAASA,gBAAT,CAA0BC,WAA1B,EAAuCC,OAAvC,EAAgD;AAC9CL,oBAAgB,IAAhB,EAAsBG,gBAAtB;;AAEA,SAAKG,YAAL,GAAoB,EAApB;AACA,SAAKC,YAAL,GAAoB,EAApB;AACA,SAAKC,kBAAL,GAA0BJ,WAA1B;AACA,SAAKK,cAAL,GAAsB,KAAtB;AACA,SAAKC,aAAL,GAAqB,IAArB;AACA,SAAKC,eAAL,GAAuBN,OAAvB;;AAEA,SAAKO,eAAL,GAAuB,IAAvB;AACA,SAAKC,oBAAL,GAA4B,GAA5B;;AAEAC,WAAOC,gBAAP,CAAwB,SAAxB,EAAmC,UAAUC,KAAV,EAAiB;AAClD,UAAI,KAAKP,cAAT,EAAyB;AACvBQ,gBAAQC,GAAR,CAAY,kCAAZ,EAAgDF,MAAMG,IAAtD;AACD;AACD,WAAKC,aAAL,CAAmBJ,MAAMG,IAAzB;AACD,KALkC,CAKjCE,IALiC,CAK5B,IAL4B,CAAnC,EAKc,KALd;AAMD;;AAEDtC,eAAaoB,gBAAb,EAA+B,CAAC;AAC9BR,SAAK,eADyB;AAE9B2B,WAAO,SAASF,aAAT,CAAuBG,OAAvB,EAAgC;AACrC,UAAIA,QAAQC,MAAR,KAAmB,sBAAvB,EAA+C;AAC7C,aAAKC,UAAL,GAAkBF,QAAQE,UAA1B;AACA,aAAKC,aAAL,GAAqBH,QAAQG,aAA7B;AACA,aAAKrB,OAAL,CAAakB,QAAQJ,IAArB;;AAEA,YAAI,KAAKV,cAAT,EAAyB;AACvBQ,kBAAQC,GAAR,CAAY,iDAAZ,EAA+DK,OAA/D;AACD;AACF,OARD,MAQO,IAAIA,QAAQC,MAAR,KAAmB,QAAvB,EAAiC;AACtC,YAAI,KAAKd,aAAT,EAAwB;AACtB,eAAKiB,cAAL,CAAoBJ,QAAQJ,IAAR,CAAaS,MAAjC;AACD;AACF,OAJM,MAIA,IAAIL,QAAQM,QAAZ,EAAsB;AAC3B;AACA,YAAIC,kBAAkB,KAAKxB,YAAL,CAAkByB,MAAlB,CAAyB,UAAUC,OAAV,EAAmB;AAChE,iBAAOA,QAAQC,SAAR,KAAsBV,QAAQM,QAAR,CAAiBI,SAA9C;AACD,SAFqB,EAEnB,CAFmB,CAAtB;;AAIA,YAAIH,gBAAgBI,QAApB,EAA8B;AAC5BJ,0BAAgBI,QAAhB,CAAyBX,QAAQJ,IAAjC;AACD;AACF;AACF;AAzB6B,GAAD,EA0B5B;AACDxB,SAAK,SADJ;AAED2B,WAAO,SAASjB,OAAT,CAAiBc,IAAjB,EAAuB;AAC5B,UAAI,KAAKX,kBAAL,IAA2B,KAAKA,kBAAL,CAAwBpB,MAAxB,GAAiC,CAAhE,EAAmE;AACjE,aAAK+C,kBAAL,CAAwB,KAAK3B,kBAA7B;AACD;;AAED,UAAI4B,4BAA4B,IAAhC;AACA,UAAIC,oBAAoB,KAAxB;AACA,UAAIC,iBAAiBC,SAArB;;AAEA,UAAI;AACF,aAAK,IAAIC,YAAY,KAAKjC,YAAL,CAAkBkC,OAAOC,QAAzB,GAAhB,EAAsDC,KAA3D,EAAkE,EAAEP,4BAA4B,CAACO,QAAQH,UAAUI,IAAV,EAAT,EAA2BC,IAAzD,CAAlE,EAAkIT,4BAA4B,IAA9J,EAAoK;AAClK,cAAIJ,UAAUW,MAAMrB,KAApB;;AAEA,eAAKwB,WAAL,CAAiBd,QAAQR,MAAzB,EAAiCQ,QAAQb,IAAzC,EAA+Ca,QAAQE,QAAvD;AACD;AACF,OAND,CAME,OAAOa,GAAP,EAAY;AACZV,4BAAoB,IAApB;AACAC,yBAAiBS,GAAjB;AACD,OATD,SASU;AACR,YAAI;AACF,cAAI,CAACX,yBAAD,IAA8BI,UAAUQ,MAA5C,EAAoD;AAClDR,sBAAUQ,MAAV;AACD;AACF,SAJD,SAIU;AACR,cAAIX,iBAAJ,EAAuB;AACrB,kBAAMC,cAAN;AACD;AACF;AACF;;AAED,WAAK/B,YAAL,GAAoB,EAApB;AACA,WAAK0C,WAAL,GAAmB9B,KAAK8B,WAAxB;AACA,WAAKC,IAAL,GAAY/B,KAAK+B,IAAjB;;AAEA,UAAI,KAAKvC,eAAT,EAA0B;AACxB,aAAKA,eAAL;AACD;AACF;AAvCA,GA1B4B,EAkE5B;AACDhB,SAAK,sBADJ;AAED2B,WAAO,SAAS6B,oBAAT,GAAgC;AACrC,aAAO,KAAKD,IAAZ;AACD;AAJA,GAlE4B,EAuE5B;AACDvD,SAAK,+BADJ;AAED2B,WAAO,SAAS8B,6BAAT,GAAyC;AAC9C,aAAO,KAAKH,WAAL,KAAqB,SAA5B;AACD;AAJA,GAvE4B,EA4E5B;AACDtD,SAAK,6BADJ;AAED2B,WAAO,SAAS+B,2BAAT,CAAqC1D,GAArC,EAA0C2B,KAA1C,EAAiD;AACtD,WAAKI,aAAL,CAAmB/B,GAAnB,IAA0B2B,KAA1B;AACA,WAAKwB,WAAL,CAAiB,oBAAjB,EAAuC,EAAEpB,eAAe,KAAKA,aAAtB,EAAvC,EAA8E,UAAUP,IAAV,EAAgB,CAAE,CAAhG;AACD;AALA,GA5E4B,EAkF5B;AACDxB,SAAK,oBADJ;AAED2B,WAAO,SAASgC,kBAAT,GAA8B;AACnC,WAAK5B,aAAL,GAAqB,EAArB;AACA,WAAKoB,WAAL,CAAiB,oBAAjB,EAAuC,EAAEpB,eAAe,KAAKA,aAAtB,EAAvC,EAA8E,UAAUP,IAAV,EAAgB,CAAE,CAAhG;AACD;AALA,GAlF4B,EAwF5B;AACDxB,SAAK,0BADJ;AAED2B,WAAO,SAASiC,wBAAT,CAAkC5D,GAAlC,EAAuC;AAC5C,aAAO,KAAK+B,aAAL,CAAmB/B,GAAnB,CAAP;AACD;AAJA,GAxF4B,EA6F5B;AACDA,SAAK,aADJ;AAED2B,WAAO,SAASwB,WAAT,CAAqBtB,MAArB,EAA6BL,IAA7B,EAAmCe,QAAnC,EAA6C;AAClD,UAAI,CAAC,KAAKT,UAAV,EAAsB;AACpB,aAAKlB,YAAL,CAAkBiD,IAAlB,CAAuB;AACrBhC,kBAAQA,MADa;AAErBL,gBAAMA,IAFe;AAGrBe,oBAAUA;AAHW,SAAvB;AAKA;AACD;;AAED,UAAIF,UAAU;AACZR,gBAAQA,MADI;AAEZL,cAAMA,IAFM;AAGZc,mBAAW,KAAKwB,YAAL,EAHC;AAIZhC,oBAAY,KAAKA,UAJL;AAKZiC,aAAK;AALO,OAAd;;AAQA,UAAIC,cAAcC,KAAKC,KAAL,CAAWD,KAAKE,SAAL,CAAe9B,OAAf,CAAX,CAAlB;AACA2B,kBAAYzB,QAAZ,GAAuBA,QAAvB;AACA,WAAK5B,YAAL,CAAkBkD,IAAlB,CAAuBG,WAAvB;;AAEA,UAAI,KAAKlD,cAAT,EAAyB;AACvBQ,gBAAQC,GAAR,CAAY,kBAAZ,EAAgCc,OAAhC;AACD;;AAEDlB,aAAOiD,MAAP,CAAcjB,WAAd,CAA0Bd,OAA1B,EAAmC,GAAnC;AACD;AA7BA,GA7F4B,EA2H5B;AACDrC,SAAK,SADJ;AAED2B,WAAO,SAAS0C,OAAT,CAAiBC,IAAjB,EAAuBC,KAAvB,EAA8BC,MAA9B,EAAsC;AAC3C,WAAKrB,WAAL,CAAiB,UAAjB,EAA6B,EAAEmB,MAAMA,IAAR,EAAcC,OAAOA,KAArB,EAA4BC,QAAQA,MAApC,EAA7B,EAA2E,UAAUhD,IAAV,EAAgB,CAAE,CAA7F;AACD;AAJA,GA3H4B,EAgI5B;AACDxB,SAAK,oBADJ;AAED2B,WAAO,SAASa,kBAAT,CAA4B/B,WAA5B,EAAyC8B,QAAzC,EAAmD;AACxD,WAAKY,WAAL,CAAiB,qBAAjB,EAAwC,EAAE1C,aAAaA,WAAf,EAAxC,EAAsE,UAAUe,IAAV,EAAgB;AACpFe,oBAAYA,UAAZ;AACD,OAFqE,CAEpEb,IAFoE,CAE/D,IAF+D,CAAtE;AAGD;AANA,GAhI4B,EAuI5B;AACD1B,SAAK,aADJ;AAED2B,WAAO,SAAS8C,WAAT,CAAqBC,YAArB,EAAmCnC,QAAnC,EAA6C;AAClD,UAAI,CAACoC,MAAMC,OAAN,CAAcF,YAAd,CAAL,EAAkC;AAChCA,uBAAe,CAACA,YAAD,CAAf;AACD;AACD,WAAKvB,WAAL,CAAiB,cAAjB,EAAiC,EAAE0B,eAAeH,YAAjB,EAAjC,EAAkE,UAAUlD,IAAV,EAAgB;AAChFe,iBAASf,KAAKsD,KAAd;AACD,OAFiE,CAEhEpD,IAFgE,CAE3D,IAF2D,CAAlE;AAGD;AATA,GAvI4B,EAiJ5B;AACD1B,SAAK,mBADJ;AAED2B,WAAO,SAASoD,iBAAT,CAA2BxC,QAA3B,EAAqC;AAC1C,WAAKY,WAAL,CAAiB,qBAAjB,EAAwC,IAAxC,EAA8C,UAAU3B,IAAV,EAAgB;AAC5D,YAAIwD,OAAOxD,KAAKwD,IAAhB;AACA;;;;;;;;AAQA;AACA;AACA;AACA;AACA;AACAzC,iBAASyC,IAAT;AACD,OAhBD;AAiBD;AApBA,GAjJ4B,EAsK5B;AACDhF,SAAK,YADJ;AAED2B,WAAO,SAASsD,UAAT,CAAoBD,IAApB,EAA0B;AAC/B,WAAK7B,WAAL,CAAiB,aAAjB,EAAgC,EAAE6B,MAAM,KAAKE,iBAAL,CAAuBF,IAAvB,CAAR,EAAhC;AACD;AAJA,GAtK4B,EA2K5B;AACDhF,SAAK,YADJ;AAED2B,WAAO,SAASwD,UAAT,CAAoBH,IAApB,EAA0BzC,QAA1B,EAAoC;AACzC,WAAKY,WAAL,CAAiB,aAAjB,EAAgC,EAAE6B,MAAM,KAAKE,iBAAL,CAAuBF,IAAvB,CAAR,EAAhC,EAAwE,UAAUxD,IAAV,EAAgB;AACtF,YAAIwD,OAAOxD,KAAKwD,IAAhB;AACA,aAAKI,aAAL,CAAmBJ,IAAnB;AACAzC,oBAAYA,SAASyC,IAAT,CAAZ;AACD,OAJuE,CAItEtD,IAJsE,CAIjE,IAJiE,CAAxE;AAKD;AARA,GA3K4B,EAoL5B;AACD1B,SAAK,eADJ;AAED2B,WAAO,SAASyD,aAAT,CAAuBJ,IAAvB,EAA6B;AAClC,WAAK7B,WAAL,CAAiB,gBAAjB,EAAmC,EAAE6B,MAAM,KAAKE,iBAAL,CAAuBF,IAAvB,CAAR,EAAnC;AACD;AAJA,GApL4B,EAyL5B;AACDhF,SAAK,iBADJ;AAED2B,WAAO,SAAS0D,eAAT,CAAyBL,IAAzB,EAA+B;AACpC,WAAK7B,WAAL,CAAiB,kBAAjB,EAAqC,EAAE6B,MAAM,KAAKE,iBAAL,CAAuBF,IAAvB,CAAR,EAArC;AACD;AAJA,GAzL4B,EA8L5B;AACDhF,SAAK,gBADJ;AAED2B,WAAO,SAAS2D,cAAT,GAA0B;AAC/B,WAAKnC,WAAL,CAAiB,iBAAjB,EAAoC,EAAEoC,cAAc,KAAhB,EAApC;AACD;AAJA,GA9L4B,EAmM5B;AACDvF,SAAK,YADJ;AAED2B,WAAO,SAAS6D,UAAT,CAAoBR,IAApB,EAA0B;AAC/B,WAAKS,WAAL,CAAiB,CAACT,IAAD,CAAjB;AACD;AAJA,GAnM4B,EAwM5B;AACDhF,SAAK,aADJ;AAED2B,WAAO,SAAS8D,WAAT,CAAqBX,KAArB,EAA4B;AACjC,UAAIY,SAAS;AACXZ,eAAOA,MAAMa,GAAN,CAAU,UAAUX,IAAV,EAAgB;AAC/B,iBAAO,KAAKE,iBAAL,CAAuBF,IAAvB,CAAP;AACD,SAFgB,CAEftD,IAFe,CAEV,IAFU,CAAV;AADI,OAAb;AAKA,WAAKyB,WAAL,CAAiB,cAAjB,EAAiCuC,MAAjC;AACD;AATA,GAxM4B,EAkN5B;AACD1F,SAAK,iBADJ;AAED2B,WAAO,SAASiE,eAAT,CAAyB/D,MAAzB,EAAiCL,IAAjC,EAAuCe,QAAvC,EAAiD;AACtD,WAAKY,WAAL,CAAiBtB,MAAjB,EAAyBL,IAAzB,EAA+B,UAAUA,IAAV,EAAgB;AAC7Ce,oBAAYA,SAASf,IAAT,CAAZ;AACD,OAF8B,CAE7BE,IAF6B,CAExB,IAFwB,CAA/B;AAGD;AANA,GAlN4B,EAyN5B;AACD1B,SAAK,UADJ;AAED2B,WAAO,SAASkE,QAAT,CAAkBb,IAAlB,EAAwBzC,QAAxB,EAAkC;AACvC,WAAKuD,SAAL,CAAe,CAACd,IAAD,CAAf,EAAuBzC,QAAvB;AACD;AAJA,GAzN4B,EA8N5B;AACDvC,SAAK,WADJ;AAED2B,WAAO,SAASmE,SAAT,CAAmBhB,KAAnB,EAA0BvC,QAA1B,EAAoC;AACzC,UAAIwD,QAAQ,IAAZ;;AAEAjB,cAAQA,MAAMa,GAAN,CAAU,UAAUX,IAAV,EAAgB;AAChCA,aAAKgB,UAAL,GAAkB,IAAIC,IAAJ,EAAlB;AACA,eAAO,KAAKf,iBAAL,CAAuBF,IAAvB,CAAP;AACD,OAHiB,CAGhBtD,IAHgB,CAGX,IAHW,CAAV,CAAR;;AAKA,UAAIwE,YAAY,SAASA,SAAT,GAAqB;AACnCH,cAAM5C,WAAN,CAAkB,YAAlB,EAAgC,EAAE2B,OAAOA,KAAT,EAAhC,EAAkD,UAAUtD,IAAV,EAAgB;AAChEe,sBAAYA,UAAZ;AACD,SAFD;AAGD,OAJD;;AAMA;;;;;;;;;AASA,UAAI,KAAKtB,eAAL,IAAwB,IAA5B,EAAkC;AAChC,YAAI,KAAKkF,WAAT,EAAsB;AACpBC,uBAAa,KAAKD,WAAlB;AACD;;AAED,aAAKA,WAAL,GAAmBE,WAAW,YAAY;AACxCH;AACD,SAFkB,EAEhB,KAAKhF,oBAFW,CAAnB;AAGD;AACF;AAlCA,GA9N4B,EAiQ5B;AACDlB,SAAK,mBADJ;AAED2B,WAAO,SAASuD,iBAAT,CAA2BF,IAA3B,EAAiC;AACtC,UAAIsB,OAAOxG,OAAOyG,MAAP,CAAc,EAAd,EAAkBvB,IAAlB,CAAX;AACAsB,WAAKE,QAAL,GAAgB,IAAhB;AACAF,WAAKlC,MAAL,GAAc,IAAd;AACA,aAAOkC,IAAP;AACD;;AAED;;AATC,GAjQ4B,EA4Q5B;AACDtG,SAAK,gBADJ;AAED2B,WAAO,SAASK,cAAT,CAAwByE,IAAxB,EAA8B;AACnC,WAAKC,yBAAL;;AAEA,UAAI,KAAK5F,cAAT,EAAyB;AACvBQ,gBAAQC,GAAR,CAAY,oBAAZ,EAAkCkF,IAAlC;AACD;;AAED,UAAI,CAACA,IAAL,EAAW;AACT;AACD;;AAED,UAAIE,6BAA6B,IAAjC;AACA,UAAIC,qBAAqB,KAAzB;AACA,UAAIC,kBAAkBjE,SAAtB;;AAEA,UAAI;AACF,aAAK,IAAIkE,aAAaL,KAAK3D,OAAOC,QAAZ,GAAjB,EAA0CgE,MAA/C,EAAuD,EAAEJ,6BAA6B,CAACI,SAASD,WAAW7D,IAAX,EAAV,EAA6BC,IAA5D,CAAvD,EAA0HyD,6BAA6B,IAAvJ,EAA6J;AAC3J,cAAIK,MAAMD,OAAOpF,KAAjB;;AAEA,cAAI,CAACqF,GAAL,EAAU;AACR;AACD;;AAED,cAAIC,OAAOC,SAASC,aAAT,CAAuB,MAAvB,CAAX;AACAF,eAAKG,IAAL,GAAYJ,GAAZ;AACAC,eAAK3C,IAAL,GAAY,UAAZ;AACA2C,eAAKI,GAAL,GAAW,YAAX;AACAJ,eAAKK,KAAL,GAAa,cAAb;AACAL,eAAKM,SAAL,GAAiB,cAAjB;AACAL,mBAASM,oBAAT,CAA8B,MAA9B,EAAsC,CAAtC,EAAyCC,WAAzC,CAAqDR,IAArD;AACD;AACF,OAhBD,CAgBE,OAAO7D,GAAP,EAAY;AACZwD,6BAAqB,IAArB;AACAC,0BAAkBzD,GAAlB;AACD,OAnBD,SAmBU;AACR,YAAI;AACF,cAAI,CAACuD,0BAAD,IAA+BG,WAAWzD,MAA9C,EAAsD;AACpDyD,uBAAWzD,MAAX;AACD;AACF,SAJD,SAIU;AACR,cAAIuD,kBAAJ,EAAwB;AACtB,kBAAMC,eAAN;AACD;AACF;AACF;AACF;AA/CA,GA5Q4B,EA4T5B;AACD7G,SAAK,2BADJ;AAED2B,WAAO,SAAS+E,yBAAT,GAAqC;AAC1C,UAAIgB,WAAWR,SAASS,sBAAT,CAAgC,cAAhC,CAAf;;AAEA,SAAGC,OAAH,CAAWC,IAAX,CAAgBH,QAAhB,EAA0B,UAAUI,OAAV,EAAmB;AAC3C,YAAIA,OAAJ,EAAa;AACXA,kBAAQC,QAAR,GAAmB,IAAnB;AACAD,kBAAQE,UAAR,CAAmBC,WAAnB,CAA+BH,OAA/B;AACD;AACF,OALD;AAMD;;AAED;;AAbC,GA5T4B,EA2U5B;AACD9H,SAAK,cADJ;AAED2B,WAAO,SAASmC,YAAT,GAAwB;AAC7B,UAAIoE,SAAS/G,OAAO+G,MAAP,IAAiB/G,OAAOgH,QAArC;AACA,UAAID,MAAJ,EAAY;AACV,YAAIE,MAAM,IAAIC,WAAJ,CAAgB,CAAhB,CAAV;AACAH,eAAOI,eAAP,CAAuBF,GAAvB;AACA,YAAIG,MAAM,CAAC,CAAX;AACA,eAAO,uCAAuCC,OAAvC,CAA+C,OAA/C,EAAwD,UAAUC,CAAV,EAAa;AAC1EF;AACA,cAAIG,IAAIN,IAAIG,OAAO,CAAX,KAAiBA,MAAM,CAAN,GAAU,CAA3B,GAA+B,EAAvC;AACA,cAAII,IAAIF,KAAK,GAAL,GAAWC,CAAX,GAAeA,IAAI,GAAJ,GAAU,GAAjC;AACA,iBAAOC,EAAEC,QAAF,CAAW,EAAX,CAAP;AACD,SALM,CAAP;AAMD,OAVD,MAUO;AACL,YAAIC,IAAI,IAAI5C,IAAJ,GAAW6C,OAAX,EAAR;AACA,YAAI3H,OAAO4H,WAAP,IAAsB,OAAO5H,OAAO4H,WAAP,CAAmBC,GAA1B,KAAkC,UAA5D,EAAwE;AACtEH,eAAKE,YAAYC,GAAZ,EAAL,CADsE,CAC9C;AACzB;AACD,YAAIzF,OAAO,uCAAuCiF,OAAvC,CAA+C,OAA/C,EAAwD,UAAUC,CAAV,EAAa;AAC9E,cAAIC,IAAI,CAACG,IAAII,KAAKC,MAAL,KAAgB,EAArB,IAA2B,EAA3B,GAAgC,CAAxC;AACAL,cAAII,KAAKE,KAAL,CAAWN,IAAI,EAAf,CAAJ;AACA,iBAAO,CAACJ,KAAK,GAAL,GAAWC,CAAX,GAAeA,IAAI,GAAJ,GAAU,GAA1B,EAA+BE,QAA/B,CAAwC,EAAxC,CAAP;AACD,SAJU,CAAX;AAKA,eAAOrF,IAAP;AACD;AACF;AA1BA,GA3U4B,CAA/B;;AAwWA,SAAO/C,gBAAP;AACD,CA/XsB,EAAvB;;AAiYA,IAAI,OAAO4I,MAAP,IAAiB,WAAjB,IAAgC,OAAOA,OAAOC,OAAd,IAAyB,WAA7D,EAA0E;AACxED,SAAOC,OAAP,GAAiB7I,gBAAjB;AACD;;AAED,IAAIW,MAAJ,EAAY;AACVA,SAAOX,gBAAP,GAA0BA,gBAA1B;AACD;AACD;AACA,CAAC;;AAED8I,QAAQF,MAAR,CAAe,KAAf,EAAsB,EAAtB;IAGOG,Q,GACL,kBAAYC,UAAZ,EAAwBC,MAAxB,EAAgCC,QAAhC,EAA0C;AAAA;;AAExCD,SAAOE,QAAP,GAAkB,EAACC,SAAS,IAAV,EAAgBC,YAAY,cAA5B,EAAlB;;AAEA,MAAIpJ,cAAc,CAChB;AACEqJ,UAAM;AADR,GADgB,CAAlB;;AAMA,MAAIC,mBAAmB,IAAI5I,OAAOX,gBAAX,CAA4BC,WAA5B,EAAyC,YAAU;AACxEgJ,WAAOE,QAAP,CAAgBC,OAAhB,GAA0B,KAA1B;AACAH,WAAO/I,OAAP;AACD,GAHsB,CAAvB;;AAKA,MAAIsJ,gBAAgB,EAApB;;AAEAD,mBAAiBhF,iBAAjB,CAAmC,UAASC,IAAT,EAAc;AAC/C0E,aAAS,YAAU;AACjBD,aAAOQ,IAAP,GAAcjF,IAAd;AACA,UAAGyE,OAAOS,KAAV,EAAiB;AACfT,eAAOU,0BAAP;AACD;AACF,KALD;AAMD,GAPD;;AASAV,SAAO/I,OAAP,GAAiB,YAAW;AAC1B+I,WAAOW,KAAP,GAAeL,iBAAiBnG,wBAAjB,CAA0C,OAA1C,CAAf;AACA,QAAG6F,OAAOW,KAAV,EAAiB;AACfX,aAAOY,UAAP;AACD;AACF,GALD;;AAOAZ,SAAOa,WAAP,GAAqB,YAAW;AAC9Bb,WAAOW,KAAP,GAAeX,OAAOE,QAAP,CAAgBS,KAA/B;AACAL,qBAAiBrG,2BAAjB,CAA6C,OAA7C,EAAsD+F,OAAOW,KAA7D;AACAX,WAAOY,UAAP;AACD,GAJD;;AAMAZ,SAAOY,UAAP,GAAoB,YAAW;;AAE7BZ,WAAOc,EAAP,GAAY,IAAIC,MAAJ,CAAW;AACrBJ,aAAOX,OAAOW;AADO,KAAX,CAAZ;;AAIA,QAAIK,KAAKhB,OAAOc,EAAP,CAAUG,OAAV,EAAT;AACAjB,WAAOE,QAAP,CAAgBgB,YAAhB,GAA+B,IAA/B;;AAEAF,OAAGG,SAAH,CAAa,UAASxH,GAAT,EAAc8G,KAAd,EAAqB;AAChCR,eAAS,YAAU;AACjBD,eAAOE,QAAP,CAAgBgB,YAAhB,GAA+B,KAA/B;AACA,YAAGvH,GAAH,EAAQ;AACNyH,gBAAM,uGAAN;AACA;AACD;AACDpB,eAAOS,KAAP,GAAeA,KAAf;AACA,YAAGT,OAAOQ,IAAV,EAAgB;AACdR,iBAAOU,0BAAP;AACD;AACF,OAVD;AAWD,KAZD;AAaD,GAtBD;;AAwBAV,SAAOU,0BAAP,GAAoC,YAAW;AAC7C,QAAIW,WAAWf,iBAAiBnG,wBAAjB,CAA0C,OAA1C,KAAsD,EAArE;AACA,QAAImH,YAAYD,SAASrB,OAAOQ,IAAP,CAAY1G,IAArB,CAAhB;AACA,QAAGwH,SAAH,EAAc;AACZ;AACAtB,aAAOuB,iBAAP,GAA2BD,UAAUE,aAArC;AACAxB,aAAOyB,iBAAP,GAA2BH,UAAUI,aAArC;AACA1B,aAAO2B,kBAAP,CAA0BL,UAAUM,QAApC;AACD,KALD,MAKO;AACL;AACA,UAAIC,cAAcvB,iBAAiBnG,wBAAjB,CAA0C,aAA1C,CAAlB;AACA,UAAG0H,WAAH,EAAgB;AACd7B,eAAOE,QAAP,CAAgB4B,cAAhB,GAAiC,IAAjC;AACA9B,eAAO2B,kBAAP,CAA0BE,WAA1B;AACD;AACF;;AAED7B,WAAO+B,oBAAP,GAA8BzB,iBAAiBnG,wBAAjB,CAA0C,sBAA1C,CAA9B;AACA6F,WAAOE,QAAP,CAAgBsB,aAAhB,GAAgCxB,OAAOuB,iBAAP,IAA4BvB,OAAO+B,oBAAnC,IAA2D,KAA3F;;AAEA/B,WAAOgC,oBAAP,GAA8B1B,iBAAiBnG,wBAAjB,CAA0C,sBAA1C,CAA9B;AACA6F,WAAOE,QAAP,CAAgBwB,aAAhB,GAAgC1B,OAAOyB,iBAAP,IAA4BzB,OAAOgC,oBAAnC,IAA2D,EAA3F;AACD,GAtBD;;AAyBAhC,SAAO2B,kBAAP,GAA4B,UAAStB,IAAT,EAAe;AACzCL,WAAOE,QAAP,CAAgB+B,YAAhB,GAA+BjC,OAAOS,KAAP,CAAa9H,MAAb,CAAoB,UAASuJ,IAAT,EAAc;AAC/D,aAAOA,KAAK7B,IAAL,KAAcA,IAArB;AACD,KAF8B,EAE5B,CAF4B,CAA/B;AAGAL,WAAOmC,aAAP;AACD,GALD;;AAOAnC,SAAOmC,aAAP,GAAuB,YAAW;AAChC,QAAID,OAAOlC,OAAOE,QAAP,CAAgB+B,YAA3B;AACAjC,WAAOoC,kBAAP,GAA4BpC,OAAOc,EAAP,CAAUuB,OAAV,CAAkBH,KAAKI,KAAL,CAAWC,KAA7B,EAAoCL,KAAK7B,IAAzC,CAA5B;;AAEA;AACAL,WAAOwC,cAAP,CAAsB,UAAtB,EAAkCN,KAAK7B,IAAvC;;AAEA;AACA,QAAG,CAACL,OAAOE,QAAP,CAAgB4B,cAApB,EAAoC;AAClCxB,uBAAiBrG,2BAAjB,CAA6C,aAA7C,EAA4DiI,KAAK7B,IAAjE;AACD;AACF,GAXD;;AAaAL,SAAOwC,cAAP,GAAwB,UAASjM,GAAT,EAAc2B,KAAd,EAAqB;AAC3C,QAAIuK,YAAYnC,iBAAiBnG,wBAAjB,CAA0C,OAA1C,KAAsD,EAAtE;AACA,QAAIkH,WAAWoB,UAAUzC,OAAOQ,IAAP,CAAY1G,IAAtB,KAA+B,EAA9C;AACAuH,aAAS9K,GAAT,IAAgB2B,KAAhB;AACAuK,cAAUzC,OAAOQ,IAAP,CAAY1G,IAAtB,IAA8BuH,QAA9B;AACAf,qBAAiBrG,2BAAjB,CAA6C,OAA7C,EAAsDwI,SAAtD;AACD,GAND;;AAQAzC,SAAO0C,qBAAP,GAA+B,UAASC,UAAT,EAAqB;AAClD;AACA,QAAI,CAACA,UAAL,EACE,OAAO,EAAP;;AAEF;AACA;AACA;AACA,WAAOA,aAAaA;AAClB;AADkB,KAEjB5D,OAFiB,CAET,QAFS,EAEC,GAFD;AAGlB;AAHkB,KAIjBA,OAJiB,CAIT,KAJS,EAIF,GAJE;AAKlB;AALkB,KAMjBA,OANiB,CAMT,OANS,EAMA,GANA;AAOlB;AACA;AARkB,KASjBA,OATiB,CAST,OATS,EASA,EATA,CAApB;AAUD,GAlBD;;AAoBAiB,SAAO4C,WAAP,GAAqB,UAASC,MAAT,EAAiB;AACpCA,WAAOhN,MAAP,CAAciN,IAAd;AACA,QAAIlK,UAAUoH,OAAOE,QAAP,CAAgB6C,aAAhB,uBAAkD/C,OAAOQ,IAAP,CAAYwC,OAAZ,CAAoBC,KAAtE,MAAd;;AAEA,QAAIzB,gBAAgBxB,OAAOE,QAAP,CAAgBsB,aAApC;AACA,QAAIE,gBAAgB1B,OAAOE,QAAP,CAAgBwB,aAApC;AACA,QAAG,CAAC1B,OAAO+B,oBAAX,EAAiC;AAC/B;AACAzB,uBAAiBrG,2BAAjB,CAA6C,sBAA7C,EAAqEuH,aAArE;AACAxB,aAAO+B,oBAAP,GAA8BP,aAA9B;AACD;;AAED,QAAGA,kBAAkBxB,OAAOuB,iBAA5B,EAA+C;AAC7C;AACAvB,aAAOwC,cAAP,CAAsB,eAAtB,EAAuChB,aAAvC;AACAxB,aAAOuB,iBAAP,GAA2BC,aAA3B;AACD;;AAED,QAAG,CAACxB,OAAOgC,oBAAX,EAAiC;AAC/B;AACA1B,uBAAiBrG,2BAAjB,CAA6C,sBAA7C,EAAqEyH,aAArE;AACA1B,aAAOgC,oBAAP,GAA8BN,aAA9B;AACD;;AAED,QAAGA,kBAAkB1B,OAAOyB,iBAA5B,EAA+C;AAC7C;AACAzB,aAAOwC,cAAP,CAAsB,eAAtB,EAAuCd,aAAvC;AACA1B,aAAOyB,iBAAP,GAA2BC,aAA3B;AACD;;AAED1B,WAAOE,QAAP,CAAgBE,UAAhB,GAA6B,YAA7B;AACAJ,WAAOoC,kBAAP,CAA0Bc,SAA1B,CAAoC,QAApC,EAA8ClD,OAAO0C,qBAAP,CAA6BhB,aAA7B,IAA8C1B,OAAOQ,IAAP,CAAYwC,OAAZ,CAAoBC,KAAlE,GAA0E,GAA1E,GAAgFzB,aAA9H,EAA6IxB,OAAOQ,IAAP,CAAYwC,OAAZ,CAAoBG,IAAjK,EAAuKvK,OAAvK,EAAgL,EAACwK,QAAQ,IAAT,EAAhL,EAAgM,UAASzJ,GAAT,EAAc0J,MAAd,EAAqB;AACnNpD,eAAS,YAAU;AACjB,YAAG,CAACtG,GAAJ,EAAS;AACPqG,iBAAOE,QAAP,CAAgB6C,aAAhB,GAAgC,EAAhC;AACA/C,iBAAOE,QAAP,CAAgBE,UAAhB,GAA6B,UAA7B;AACAH,mBAAS,YAAU;AACjBD,mBAAOE,QAAP,CAAgBE,UAAhB,GAA6B,cAA7B;AACD,WAFD,EAEG,IAFH;AAGD,SAND,MAMO;AACLgB,gBAAM,mDAAN,EAA2D,CAAEzH,GAA7D;AACD;AACF,OAVD;AAWD,KAZD;AAaD,GA5CD;;AA8CAqG,SAAOsD,MAAP,GAAgB,YAAW;AACzBhD,qBAAiBpG,kBAAjB;AACA8F,WAAO+B,oBAAP,GAA8B,IAA9B;AACA/B,WAAOgC,oBAAP,GAA8B,IAA9B;AACAhC,WAAOuB,iBAAP,GAA2B,IAA3B;AACAvB,WAAOyB,iBAAP,GAA2B,IAA3B;AACAzB,WAAOiC,YAAP,GAAsB,IAAtB;AACAjC,WAAOS,KAAP,GAAe,IAAf;AACAT,WAAOW,KAAP,GAAe,IAAf;AACD,GATD;;AAWAL,mBAAiB1F,OAAjB,CAAyB,WAAzB,EAAsC,MAAtC,EAA8C2F,aAA9C;AAGD,C;;AAGH;;;AACAT,SAASyD,WAAT,GAAuB,IAAvB;;AAEA1D,QAAQF,MAAR,CAAe,KAAf,EAAsB6D,UAAtB,CAAiC,UAAjC,EAA6C1D,QAA7C","file":"app.js","sourcesContent":["\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ComponentManager = function () {\n  function ComponentManager(permissions, onReady) {\n    _classCallCheck(this, ComponentManager);\n\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.initialPermissions = permissions;\n    this.loggingEnabled = false;\n    this.acceptsThemes = true;\n    this.onReadyCallback = onReady;\n\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n\n    window.addEventListener(\"message\", function (event) {\n      if (this.loggingEnabled) {\n        console.log(\"Components API Message received:\", event.data);\n      }\n      this.handleMessage(event.data);\n    }.bind(this), false);\n  }\n\n  _createClass(ComponentManager, [{\n    key: \"handleMessage\",\n    value: function handleMessage(payload) {\n      if (payload.action === \"component-registered\") {\n        this.sessionKey = payload.sessionKey;\n        this.componentData = payload.componentData;\n        this.onReady(payload.data);\n\n        if (this.loggingEnabled) {\n          console.log(\"Component successfully registered with payload:\", payload);\n        }\n      } else if (payload.action === \"themes\") {\n        if (this.acceptsThemes) {\n          this.activateThemes(payload.data.themes);\n        }\n      } else if (payload.original) {\n        // get callback from queue\n        var originalMessage = this.sentMessages.filter(function (message) {\n          return message.messageId === payload.original.messageId;\n        })[0];\n\n        if (originalMessage.callback) {\n          originalMessage.callback(payload.data);\n        }\n      }\n    }\n  }, {\n    key: \"onReady\",\n    value: function onReady(data) {\n      if (this.initialPermissions && this.initialPermissions.length > 0) {\n        this.requestPermissions(this.initialPermissions);\n      }\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.messageQueue[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var message = _step.value;\n\n          this.postMessage(message.action, message.data, message.callback);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.messageQueue = [];\n      this.environment = data.environment;\n      this.uuid = data.uuid;\n\n      if (this.onReadyCallback) {\n        this.onReadyCallback();\n      }\n    }\n  }, {\n    key: \"getSelfComponentUUID\",\n    value: function getSelfComponentUUID() {\n      return this.uuid;\n    }\n  }, {\n    key: \"isRunningInDesktopApplication\",\n    value: function isRunningInDesktopApplication() {\n      return this.environment === \"desktop\";\n    }\n  }, {\n    key: \"setComponentDataValueForKey\",\n    value: function setComponentDataValueForKey(key, value) {\n      this.componentData[key] = value;\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"clearComponentData\",\n    value: function clearComponentData() {\n      this.componentData = {};\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"componentDataValueForKey\",\n    value: function componentDataValueForKey(key) {\n      return this.componentData[key];\n    }\n  }, {\n    key: \"postMessage\",\n    value: function postMessage(action, data, callback) {\n      if (!this.sessionKey) {\n        this.messageQueue.push({\n          action: action,\n          data: data,\n          callback: callback\n        });\n        return;\n      }\n\n      var message = {\n        action: action,\n        data: data,\n        messageId: this.generateUUID(),\n        sessionKey: this.sessionKey,\n        api: \"component\"\n      };\n\n      var sentMessage = JSON.parse(JSON.stringify(message));\n      sentMessage.callback = callback;\n      this.sentMessages.push(sentMessage);\n\n      if (this.loggingEnabled) {\n        console.log(\"Posting message:\", message);\n      }\n\n      window.parent.postMessage(message, '*');\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(type, width, height) {\n      this.postMessage(\"set-size\", { type: type, width: width, height: height }, function (data) {});\n    }\n  }, {\n    key: \"requestPermissions\",\n    value: function requestPermissions(permissions, callback) {\n      this.postMessage(\"request-permissions\", { permissions: permissions }, function (data) {\n        callback && callback();\n      }.bind(this));\n    }\n  }, {\n    key: \"streamItems\",\n    value: function streamItems(contentTypes, callback) {\n      if (!Array.isArray(contentTypes)) {\n        contentTypes = [contentTypes];\n      }\n      this.postMessage(\"stream-items\", { content_types: contentTypes }, function (data) {\n        callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"streamContextItem\",\n    value: function streamContextItem(callback) {\n      this.postMessage(\"stream-context-item\", null, function (data) {\n        var item = data.item;\n        /*\n          When an item is saved via saveItem, its updated_at value is set client side to the current date.\n          If we make a change locally, then for whatever reason receive an item via streamItems/streamContextItem,\n          we want to ignore that change if it was made prior to the latest change we've made.\n           Update 1/22/18: However, if a user is restoring a note from version history, this change\n          will not pass through this filter and will thus be ignored. Because the client now handles\n          this case with isMetadataUpdate, we no longer need the below.\n        */\n        // if(this.streamedContextItem && this.streamedContextItem.uuid == item.uuid\n        //   && this.streamedContextItem.updated_at > item.updated_at) {\n        //   return;\n        // }\n        // this.streamedContextItem = item;\n        callback(item);\n      });\n    }\n  }, {\n    key: \"selectItem\",\n    value: function selectItem(item) {\n      this.postMessage(\"select-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"createItem\",\n    value: function createItem(item, callback) {\n      this.postMessage(\"create-item\", { item: this.jsonObjectForItem(item) }, function (data) {\n        var item = data.item;\n        this.associateItem(item);\n        callback && callback(item);\n      }.bind(this));\n    }\n  }, {\n    key: \"associateItem\",\n    value: function associateItem(item) {\n      this.postMessage(\"associate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"deassociateItem\",\n    value: function deassociateItem(item) {\n      this.postMessage(\"deassociate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"clearSelection\",\n    value: function clearSelection() {\n      this.postMessage(\"clear-selection\", { content_type: \"Tag\" });\n    }\n  }, {\n    key: \"deleteItem\",\n    value: function deleteItem(item) {\n      this.deleteItems([item]);\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function deleteItems(items) {\n      var params = {\n        items: items.map(function (item) {\n          return this.jsonObjectForItem(item);\n        }.bind(this))\n      };\n      this.postMessage(\"delete-items\", params);\n    }\n  }, {\n    key: \"sendCustomEvent\",\n    value: function sendCustomEvent(action, data, callback) {\n      this.postMessage(action, data, function (data) {\n        callback && callback(data);\n      }.bind(this));\n    }\n  }, {\n    key: \"saveItem\",\n    value: function saveItem(item, callback) {\n      this.saveItems([item], callback);\n    }\n  }, {\n    key: \"saveItems\",\n    value: function saveItems(items, callback) {\n      var _this = this;\n\n      items = items.map(function (item) {\n        item.updated_at = new Date();\n        return this.jsonObjectForItem(item);\n      }.bind(this));\n\n      var saveBlock = function saveBlock() {\n        _this.postMessage(\"save-items\", { items: items }, function (data) {\n          callback && callback();\n        });\n      };\n\n      /*\n          Coallesed saving prevents saves from being made after every keystroke, and instead\n          waits coallesedSavingDelay before performing action. For example, if a user types a keystroke, and the clienet calls saveItem,\n          a 250ms delay will begin. If they type another keystroke within 250ms, the previously pending\n          save will be cancelled, and another 250ms delay occurs. If ater 250ms the pending delay is not cleared by a future call,\n          the save will finally trigger.\n           Note: it's important to modify saving items updated_at immediately and not after delay. If you modify after delay,\n          a delayed sync could just be wrapping up, and will send back old data and replace what the user has typed.\n      */\n      if (this.coallesedSaving == true) {\n        if (this.pendingSave) {\n          clearTimeout(this.pendingSave);\n        }\n\n        this.pendingSave = setTimeout(function () {\n          saveBlock();\n        }, this.coallesedSavingDelay);\n      }\n    }\n  }, {\n    key: \"jsonObjectForItem\",\n    value: function jsonObjectForItem(item) {\n      var copy = Object.assign({}, item);\n      copy.children = null;\n      copy.parent = null;\n      return copy;\n    }\n\n    /* Themes */\n\n  }, {\n    key: \"activateThemes\",\n    value: function activateThemes(urls) {\n      this.deactivateAllCustomThemes();\n\n      if (this.loggingEnabled) {\n        console.log(\"Activating themes:\", urls);\n      }\n\n      if (!urls) {\n        return;\n      }\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = urls[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var url = _step2.value;\n\n          if (!url) {\n            continue;\n          }\n\n          var link = document.createElement(\"link\");\n          link.href = url;\n          link.type = \"text/css\";\n          link.rel = \"stylesheet\";\n          link.media = \"screen,print\";\n          link.className = \"custom-theme\";\n          document.getElementsByTagName(\"head\")[0].appendChild(link);\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"deactivateAllCustomThemes\",\n    value: function deactivateAllCustomThemes() {\n      var elements = document.getElementsByClassName(\"custom-theme\");\n\n      [].forEach.call(elements, function (element) {\n        if (element) {\n          element.disabled = true;\n          element.parentNode.removeChild(element);\n        }\n      });\n    }\n\n    /* Utilities */\n\n  }, {\n    key: \"generateUUID\",\n    value: function generateUUID() {\n      var crypto = window.crypto || window.msCrypto;\n      if (crypto) {\n        var buf = new Uint32Array(4);\n        crypto.getRandomValues(buf);\n        var idx = -1;\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          idx++;\n          var r = buf[idx >> 3] >> idx % 8 * 4 & 15;\n          var v = c == 'x' ? r : r & 0x3 | 0x8;\n          return v.toString(16);\n        });\n      } else {\n        var d = new Date().getTime();\n        if (window.performance && typeof window.performance.now === \"function\") {\n          d += performance.now(); //use high-precision timer if available\n        }\n        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          var r = (d + Math.random() * 16) % 16 | 0;\n          d = Math.floor(d / 16);\n          return (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n        });\n        return uuid;\n      }\n    }\n  }]);\n\n  return ComponentManager;\n}();\n\nif (typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif (window) {\n  window.ComponentManager = ComponentManager;\n}\n//# sourceMappingURL=dist.js.map\n;'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    $scope.formData = {loading: true, pushStatus: \"Push Changes\"};\n\n    var permissions = [\n      {\n        name: \"stream-context-item\"\n      }\n    ]\n\n    let componentManager = new window.ComponentManager(permissions, function(){\n      $scope.formData.loading = false;\n      $scope.onReady();\n    });\n\n    let defaultHeight = 50;\n\n    componentManager.streamContextItem(function(item){\n      $timeout(function(){\n        $scope.note = item;\n        if($scope.repos) {\n          $scope.loadRepoDataForCurrentNote();\n        }\n      })\n    })\n\n    $scope.onReady = function() {\n      $scope.token = componentManager.componentDataValueForKey(\"token\");\n      if($scope.token) {\n        $scope.onTokenSet();\n      }\n    }\n\n    $scope.submitToken = function() {\n      $scope.token = $scope.formData.token;\n      componentManager.setComponentDataValueForKey(\"token\", $scope.token);\n      $scope.onTokenSet();\n    }\n\n    $scope.onTokenSet = function() {\n\n      $scope.gh = new GitHub({\n        token: $scope.token\n      });\n\n      var me = $scope.gh.getUser();\n      $scope.formData.loadingRepos = true;\n\n      me.listRepos(function(err, repos) {\n        $timeout(function(){\n          $scope.formData.loadingRepos = false;\n          if(err) {\n            alert(\"An error occurred with the GitHub Push extension. Make sure your GitHub token is valid and try again.\")\n            return;\n          }\n          $scope.repos = repos;\n          if($scope.note) {\n            $scope.loadRepoDataForCurrentNote();\n          }\n        })\n      });\n    }\n\n    $scope.loadRepoDataForCurrentNote = function() {\n      var noteData = componentManager.componentDataValueForKey(\"notes\") || {};\n      var savedNote = noteData[$scope.note.uuid];\n      if(savedNote) {\n        // per note preference\n        $scope.noteFileExtension = savedNote.fileExtension;\n        $scope.noteFileDirectory = savedNote.fileDirectory;\n        $scope.selectRepoWithName(savedNote.repoName);\n      } else {\n        // default pref\n        var defaultRepo = componentManager.componentDataValueForKey(\"defaultRepo\");\n        if(defaultRepo) {\n          $scope.formData.hasDefaultRepo = true;\n          $scope.selectRepoWithName(defaultRepo);\n        }\n      }\n\n      $scope.defaultFileExtension = componentManager.componentDataValueForKey(\"defaultFileExtension\");\n      $scope.formData.fileExtension = $scope.noteFileExtension || $scope.defaultFileExtension || \"txt\";\n      \n      $scope.defaultFileDirectory = componentManager.componentDataValueForKey(\"defaultFileDirectory\");\n      $scope.formData.fileDirectory = $scope.noteFileDirectory || $scope.defaultFileDirectory || \"\";\n    }\n\n\n    $scope.selectRepoWithName = function(name) {\n      $scope.formData.selectedRepo = $scope.repos.filter(function(repo){\n        return repo.name === name;\n      })[0];\n      $scope.didSelectRepo();\n    }\n\n    $scope.didSelectRepo = function() {\n      var repo = $scope.formData.selectedRepo;\n      $scope.selectedRepoObject = $scope.gh.getRepo(repo.owner.login, repo.name);\n\n      // save this as default repo for this note\n      $scope.setDataForNote(\"repoName\", repo.name);\n\n      // save this as default repo globally\n      if(!$scope.formData.hasDefaultRepo) {\n        componentManager.setComponentDataValueForKey(\"defaultRepo\", repo.name);\n      }\n    }\n\n    $scope.setDataForNote = function(key, value) {\n      var notesData = componentManager.componentDataValueForKey(\"notes\") || {};\n      var noteData = notesData[$scope.note.uuid] || {};\n      noteData[key] = value;\n      notesData[$scope.note.uuid] = noteData;\n      componentManager.setComponentDataValueForKey(\"notes\", notesData);\n    }\n\n    $scope.sanitizeFileDirectory = function($directory) {\n      // if no directory is given, then push to root.\n      if (!$directory)\n        return '';\n      \n      // try to ensure they haven't attempted any funny business with escape strings by turning\n      // any backslashes into forward slashes - then replace any duplicate slashes with a single\n      // slash.\n      return $directory = $directory\n        // make sure the last symbol is a '/'\n        .replace(/[/]*$/g, '/')\n        // make sure there are no escaping slashes.\n        .replace(/\\\\/g, '/')\n        // make sure there are no double '//'.\n        .replace(/\\/\\//g, '/')\n        // make sure the directory does not start with\n        // a '/'.\n        .replace(/^\\/+/g, '');\n    }\n\n    $scope.pushChanges = function($event) {\n      $event.target.blur();\n      var message = $scope.formData.commitMessage || `Updated note '${$scope.note.content.title}'`;\n\n      var fileExtension = $scope.formData.fileExtension;\n      var fileDirectory = $scope.formData.fileDirectory;\n      if(!$scope.defaultFileExtension) {\n        // set this as default\n        componentManager.setComponentDataValueForKey(\"defaultFileExtension\", fileExtension);\n        $scope.defaultFileExtension = fileExtension;\n      }\n\n      if(fileExtension !== $scope.noteFileExtension) {\n        // set this ext for this note\n        $scope.setDataForNote(\"fileExtension\", fileExtension);\n        $scope.noteFileExtension = fileExtension;\n      }\n\n      if(!$scope.defaultFileDirectory) {\n        // set this as default\n        componentManager.setComponentDataValueForKey(\"defaultFileDirectory\", fileDirectory);\n        $scope.defaultFileDirectory = fileDirectory;\n      }\n\n      if(fileDirectory !== $scope.noteFileDirectory) {\n        // set this directory for the note\n        $scope.setDataForNote(\"fileDirectory\", fileDirectory);\n        $scope.noteFileDirectory = fileDirectory;\n      }\n\n      $scope.formData.pushStatus = \"Pushing...\";\n      $scope.selectedRepoObject.writeFile(\"master\", $scope.sanitizeFileDirectory(fileDirectory) + $scope.note.content.title + \".\" + fileExtension, $scope.note.content.text, message, {encode: true}, function(err, result){\n        $timeout(function(){\n          if(!err) {\n            $scope.formData.commitMessage = \"\";\n            $scope.formData.pushStatus = \"Success!\";\n            $timeout(function(){\n              $scope.formData.pushStatus = \"Push Changes\";\n            }, 1500)\n          } else {\n            alert(\"Something went wrong trying to push your changes.\", + err);\n          }\n        })\n      });\n    }\n\n    $scope.logout = function() {\n      componentManager.clearComponentData();\n      $scope.defaultFileExtension = null;\n      $scope.defaultFileDirectory = null;\n      $scope.noteFileExtension = null;\n      $scope.noteFileDirectory = null;\n      $scope.selectedRepo = null;\n      $scope.repos = null;\n      $scope.token = null;\n    }\n\n    componentManager.setSize(\"container\", \"100%\", defaultHeight);\n\n\n  }\n}\n\n// required for FireFox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n"]}