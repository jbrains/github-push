{"version":3,"sources":["app.js"],"names":["angular","module","HomeCtrl","constructor","$rootScope","$scope","$timeout","formData","loading","pushStatus","componentManager","window","ComponentManager","onReady","defaultHeight","streamContextItem","item","note","repos","loadRepoDataForCurrentNote","token","componentDataValueForKey","onTokenSet","submitToken","setComponentDataValueForKey","gh","GitHub","me","getUser","loadingRepos","listRepos","err","alert","noteData","savedNote","uuid","noteFileExtension","fileExtension","selectRepoWithName","repoName","defaultRepo","hasDefaultRepo","defaultFileExtension","name","selectedRepo","filter","repo","didSelectRepo","selectedRepoObject","getRepo","owner","login","setDataForNote","key","value","notesData","pushChanges","$event","target","blur","message","commitMessage","content","title","console","log","writeFile","text","encode","result","logout","clearComponentData","setSize","$$ngIsClass","controller"],"mappings":"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","file":"app.js","sourcesContent":["'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    $scope.formData = {loading: true, pushStatus: \"Push Changes\"};\n\n    let componentManager = new window.ComponentManager(true, function(){\n      $scope.formData.loading = false;\n      $scope.onReady();\n    });\n\n    let defaultHeight = 50;\n\n    componentManager.streamContextItem(function(item){\n      $timeout(function(){\n        $scope.note = item;\n        if($scope.repos) {\n          $scope.loadRepoDataForCurrentNote();\n        }\n      })\n    })\n\n    $scope.onReady = function() {\n      $scope.token = componentManager.componentDataValueForKey(\"token\");\n      if($scope.token) {\n        $scope.onTokenSet();\n      }\n    }\n\n    $scope.submitToken = function() {\n      $scope.token = $scope.formData.token;\n      componentManager.setComponentDataValueForKey(\"token\", $scope.token);\n      $scope.onTokenSet();\n    }\n\n    $scope.onTokenSet = function() {\n\n      $scope.gh = new GitHub({\n        token: $scope.token\n      });\n\n      var me = $scope.gh.getUser();\n      $scope.formData.loadingRepos = true;\n\n      me.listRepos(function(err, repos) {\n        $timeout(function(){\n          $scope.formData.loadingRepos = false;\n          if(err) {\n            alert(\"An error occurred with the GitHub Push extension. Make sure your GitHub token is valid and try again.\")\n            return;\n          }\n          $scope.repos = repos;\n          $scope.loadRepoDataForCurrentNote();\n        })\n      });\n    }\n\n    $scope.loadRepoDataForCurrentNote = function() {\n      var noteData = componentManager.componentDataValueForKey(\"notes\") || {};\n      var savedNote = noteData[$scope.note.uuid];\n      if(savedNote) {\n        // per note preference\n        $scope.noteFileExtension = savedNote.fileExtension;\n        $scope.selectRepoWithName(savedNote.repoName);\n      } else {\n        // default pref\n        var defaultRepo = componentManager.componentDataValueForKey(\"defaultRepo\");\n        if(defaultRepo) {\n          $scope.formData.hasDefaultRepo = true;\n          $scope.selectRepoWithName(defaultRepo);\n        }\n      }\n\n      $scope.defaultFileExtension = componentManager.componentDataValueForKey(\"defaultFileExtension\");\n      $scope.formData.fileExtension = $scope.noteFileExtension || $scope.defaultFileExtension || \"txt\";\n    }\n\n\n    $scope.selectRepoWithName = function(name) {\n      $scope.formData.selectedRepo = $scope.repos.filter(function(repo){\n        return repo.name === name;\n      })[0];\n      $scope.didSelectRepo();\n    }\n\n    $scope.didSelectRepo = function() {\n      var repo = $scope.formData.selectedRepo;\n      $scope.selectedRepoObject = $scope.gh.getRepo(repo.owner.login, repo.name);\n\n      // save this as default repo for this note\n      $scope.setDataForNote(\"repoName\", repo.name);\n\n      // save this as default repo globally\n      if(!$scope.formData.hasDefaultRepo) {\n        componentManager.setComponentDataValueForKey(\"defaultRepo\", repo.name);\n      }\n    }\n\n    $scope.setDataForNote = function(key, value) {\n      var notesData = componentManager.componentDataValueForKey(\"notes\") || {};\n      var noteData = notesData[$scope.note.uuid] || {};\n      noteData[key] = value;\n      notesData[$scope.note.uuid] = noteData;\n      componentManager.setComponentDataValueForKey(\"notes\", notesData);\n    }\n\n    $scope.pushChanges = function($event) {\n      $event.target.blur();\n      var message = $scope.formData.commitMessage || `Updated note '${$scope.note.content.title}'`;\n\n      var fileExtension = $scope.formData.fileExtension;\n      if(!$scope.defaultFileExtension) {\n        // set this as default\n        console.log(\"Setting as default file ext\", fileExtension);\n        componentManager.setComponentDataValueForKey(\"defaultFileExtension\", fileExtension);\n        $scope.defaultFileExtension = fileExtension;\n      }\n\n      if(fileExtension !== $scope.noteFileExtension) {\n        // set this ext for this note\n        console.log(\"Setting as note file ext\", fileExtension);\n        $scope.setDataForNote(\"fileExtension\", fileExtension);\n        $scope.noteFileExtension = fileExtension;\n      }\n\n      $scope.formData.pushStatus = \"Pushing...\";\n      $scope.selectedRepoObject.writeFile(\"master\", $scope.note.content.title + \".\" + fileExtension, $scope.note.content.text, message, {encode: true}, function(err, result){\n        $timeout(function(){\n          if(!err) {\n            $scope.formData.commitMessage = \"\";\n            $scope.formData.pushStatus = \"Success!\";\n            $timeout(function(){\n              $scope.formData.pushStatus = \"Push Changes\";\n            }, 1500)\n          } else {\n            alert(\"Something went wrong trying to push your changes.\", + err);\n          }\n        })\n        console.log(\"Write file\", err, result);\n      });\n    }\n\n    $scope.logout = function() {\n      componentManager.clearComponentData();\n      $scope.defaultFileExtension = null;\n      $scope.noteFileExtension = null;\n      $scope.selectedRepo = null;\n      $scope.repos = null;\n      $scope.token = null;\n    }\n\n    componentManager.setSize(\"container\", \"100%\", defaultHeight);\n\n\n  }\n}\n\n// required for FireFox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n"]}