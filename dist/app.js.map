{"version":3,"sources":["app.js"],"names":["angular","module","HomeCtrl","$rootScope","$scope","$timeout","formData","loading","pushStatus","permissions","name","componentManager","window","ComponentManager","onReady","defaultHeight","streamContextItem","item","note","repos","loadRepoDataForCurrentNote","token","componentDataValueForKey","onTokenSet","submitToken","setComponentDataValueForKey","gh","GitHub","me","getUser","loadingRepos","listRepos","err","alert","noteData","savedNote","uuid","noteFileExtension","fileExtension","noteFileDirectory","fileDirectory","selectRepoWithName","repoName","defaultRepo","hasDefaultRepo","defaultFileExtension","defaultFileDirectory","selectedRepo","filter","repo","didSelectRepo","selectedRepoObject","getRepo","owner","login","setDataForNote","key","value","notesData","sanitizeFileDirectory","$directory","replace","pushChanges","$event","target","blur","message","commitMessage","content","title","writeFile","text","encode","result","logout","clearComponentData","setSize","$$ngIsClass","controller"],"mappings":"AAAA;;;;AAEAA,QAAQC,MAAR,CAAe,KAAf,EAAsB,EAAtB;IAGOC,Q,GACL,kBAAYC,UAAZ,EAAwBC,MAAxB,EAAgCC,QAAhC,EAA0C;AAAA;;AAExCD,SAAOE,QAAP,GAAkB,EAACC,SAAS,IAAV,EAAgBC,YAAY,cAA5B,EAAlB;;AAEA,MAAIC,cAAc,CAChB;AACEC,UAAM;AADR,GADgB,CAAlB;;AAMA,MAAIC,mBAAmB,IAAIC,OAAOC,gBAAX,CAA4BJ,WAA5B,EAAyC,YAAU;AACxEL,WAAOE,QAAP,CAAgBC,OAAhB,GAA0B,KAA1B;AACAH,WAAOU,OAAP;AACD,GAHsB,CAAvB;;AAKA,MAAIC,gBAAgB,EAApB;;AAEAJ,mBAAiBK,iBAAjB,CAAmC,UAASC,IAAT,EAAc;AAC/CZ,aAAS,YAAU;AACjBD,aAAOc,IAAP,GAAcD,IAAd;AACA,UAAGb,OAAOe,KAAV,EAAiB;AACff,eAAOgB,0BAAP;AACD;AACF,KALD;AAMD,GAPD;;AASAhB,SAAOU,OAAP,GAAiB,YAAW;AAC1BV,WAAOiB,KAAP,GAAeV,iBAAiBW,wBAAjB,CAA0C,OAA1C,CAAf;AACA,QAAGlB,OAAOiB,KAAV,EAAiB;AACfjB,aAAOmB,UAAP;AACD;AACF,GALD;;AAOAnB,SAAOoB,WAAP,GAAqB,YAAW;AAC9BpB,WAAOiB,KAAP,GAAejB,OAAOE,QAAP,CAAgBe,KAA/B;AACAV,qBAAiBc,2BAAjB,CAA6C,OAA7C,EAAsDrB,OAAOiB,KAA7D;AACAjB,WAAOmB,UAAP;AACD,GAJD;;AAMAnB,SAAOmB,UAAP,GAAoB,YAAW;;AAE7BnB,WAAOsB,EAAP,GAAY,IAAIC,MAAJ,CAAW;AACrBN,aAAOjB,OAAOiB;AADO,KAAX,CAAZ;;AAIA,QAAIO,KAAKxB,OAAOsB,EAAP,CAAUG,OAAV,EAAT;AACAzB,WAAOE,QAAP,CAAgBwB,YAAhB,GAA+B,IAA/B;;AAEAF,OAAGG,SAAH,CAAa,UAASC,GAAT,EAAcb,KAAd,EAAqB;AAChCd,eAAS,YAAU;AACjBD,eAAOE,QAAP,CAAgBwB,YAAhB,GAA+B,KAA/B;AACA,YAAGE,GAAH,EAAQ;AACNC,gBAAM,uGAAN;AACA;AACD;AACD7B,eAAOe,KAAP,GAAeA,KAAf;AACA,YAAGf,OAAOc,IAAV,EAAgB;AACdd,iBAAOgB,0BAAP;AACD;AACF,OAVD;AAWD,KAZD;AAaD,GAtBD;;AAwBAhB,SAAOgB,0BAAP,GAAoC,YAAW;AAC7C,QAAIc,WAAWvB,iBAAiBW,wBAAjB,CAA0C,OAA1C,KAAsD,EAArE;AACA,QAAIa,YAAYD,SAAS9B,OAAOc,IAAP,CAAYkB,IAArB,CAAhB;AACA,QAAGD,SAAH,EAAc;AACZ;AACA/B,aAAOiC,iBAAP,GAA2BF,UAAUG,aAArC;AACAlC,aAAOmC,iBAAP,GAA2BJ,UAAUK,aAArC;AACApC,aAAOqC,kBAAP,CAA0BN,UAAUO,QAApC;AACD,KALD,MAKO;AACL;AACA,UAAIC,cAAchC,iBAAiBW,wBAAjB,CAA0C,aAA1C,CAAlB;AACA,UAAGqB,WAAH,EAAgB;AACdvC,eAAOE,QAAP,CAAgBsC,cAAhB,GAAiC,IAAjC;AACAxC,eAAOqC,kBAAP,CAA0BE,WAA1B;AACD;AACF;;AAEDvC,WAAOyC,oBAAP,GAA8BlC,iBAAiBW,wBAAjB,CAA0C,sBAA1C,CAA9B;AACAlB,WAAOE,QAAP,CAAgBgC,aAAhB,GAAgClC,OAAOiC,iBAAP,IAA4BjC,OAAOyC,oBAAnC,IAA2D,KAA3F;;AAEAzC,WAAO0C,oBAAP,GAA8BnC,iBAAiBW,wBAAjB,CAA0C,sBAA1C,CAA9B;AACAlB,WAAOE,QAAP,CAAgBkC,aAAhB,GAAgCpC,OAAOmC,iBAAP,IAA4BnC,OAAO0C,oBAAnC,IAA2D,EAA3F;AACD,GAtBD;;AAyBA1C,SAAOqC,kBAAP,GAA4B,UAAS/B,IAAT,EAAe;AACzCN,WAAOE,QAAP,CAAgByC,YAAhB,GAA+B3C,OAAOe,KAAP,CAAa6B,MAAb,CAAoB,UAASC,IAAT,EAAc;AAC/D,aAAOA,KAAKvC,IAAL,KAAcA,IAArB;AACD,KAF8B,EAE5B,CAF4B,CAA/B;AAGAN,WAAO8C,aAAP;AACD,GALD;;AAOA9C,SAAO8C,aAAP,GAAuB,YAAW;AAChC,QAAID,OAAO7C,OAAOE,QAAP,CAAgByC,YAA3B;AACA3C,WAAO+C,kBAAP,GAA4B/C,OAAOsB,EAAP,CAAU0B,OAAV,CAAkBH,KAAKI,KAAL,CAAWC,KAA7B,EAAoCL,KAAKvC,IAAzC,CAA5B;;AAEA;AACAN,WAAOmD,cAAP,CAAsB,UAAtB,EAAkCN,KAAKvC,IAAvC;;AAEA;AACA,QAAG,CAACN,OAAOE,QAAP,CAAgBsC,cAApB,EAAoC;AAClCjC,uBAAiBc,2BAAjB,CAA6C,aAA7C,EAA4DwB,KAAKvC,IAAjE;AACD;AACF,GAXD;;AAaAN,SAAOmD,cAAP,GAAwB,UAASC,GAAT,EAAcC,KAAd,EAAqB;AAC3C,QAAIC,YAAY/C,iBAAiBW,wBAAjB,CAA0C,OAA1C,KAAsD,EAAtE;AACA,QAAIY,WAAWwB,UAAUtD,OAAOc,IAAP,CAAYkB,IAAtB,KAA+B,EAA9C;AACAF,aAASsB,GAAT,IAAgBC,KAAhB;AACAC,cAAUtD,OAAOc,IAAP,CAAYkB,IAAtB,IAA8BF,QAA9B;AACAvB,qBAAiBc,2BAAjB,CAA6C,OAA7C,EAAsDiC,SAAtD;AACD,GAND;;AAQAtD,SAAOuD,qBAAP,GAA+B,UAASC,UAAT,EAAqB;AAClD;AACA,QAAI,CAACA,UAAL,EACE,OAAO,EAAP;;AAEF;AACA;AACA;AACA,WAAOA,aAAaA;AAClB;AADkB,KAEjBC,OAFiB,CAET,QAFS,EAEC,GAFD;AAGlB;AAHkB,KAIjBA,OAJiB,CAIT,KAJS,EAIF,GAJE;AAKlB;AALkB,KAMjBA,OANiB,CAMT,OANS,EAMA,GANA;AAOlB;AACA;AARkB,KASjBA,OATiB,CAST,OATS,EASA,EATA,CAApB;AAUD,GAlBD;;AAoBAzD,SAAO0D,WAAP,GAAqB,UAASC,MAAT,EAAiB;AACpCA,WAAOC,MAAP,CAAcC,IAAd;AACA,QAAIC,UAAU9D,OAAOE,QAAP,CAAgB6D,aAAhB,wBAAkD/D,OAAOc,IAAP,CAAYkD,OAAZ,CAAoBC,KAAtE,OAAd;;AAEA,QAAI/B,gBAAgBlC,OAAOE,QAAP,CAAgBgC,aAApC;AACA,QAAIE,gBAAgBpC,OAAOE,QAAP,CAAgBkC,aAApC;AACA,QAAG,CAACpC,OAAOyC,oBAAX,EAAiC;AAC/B;AACAlC,uBAAiBc,2BAAjB,CAA6C,sBAA7C,EAAqEa,aAArE;AACAlC,aAAOyC,oBAAP,GAA8BP,aAA9B;AACD;;AAED,QAAGA,kBAAkBlC,OAAOiC,iBAA5B,EAA+C;AAC7C;AACAjC,aAAOmD,cAAP,CAAsB,eAAtB,EAAuCjB,aAAvC;AACAlC,aAAOiC,iBAAP,GAA2BC,aAA3B;AACD;;AAED,QAAG,CAAClC,OAAO0C,oBAAX,EAAiC;AAC/B;AACAnC,uBAAiBc,2BAAjB,CAA6C,sBAA7C,EAAqEe,aAArE;AACApC,aAAO0C,oBAAP,GAA8BN,aAA9B;AACD;;AAED,QAAGA,kBAAkBpC,OAAOmC,iBAA5B,EAA+C;AAC7C;AACAnC,aAAOmD,cAAP,CAAsB,eAAtB,EAAuCf,aAAvC;AACApC,aAAOmC,iBAAP,GAA2BC,aAA3B;AACD;;AAEDpC,WAAOE,QAAP,CAAgBE,UAAhB,GAA6B,YAA7B;AACAJ,WAAO+C,kBAAP,CAA0BmB,SAA1B,CAAoC,QAApC,EAA8ClE,OAAOuD,qBAAP,CAA6BnB,aAA7B,IAA8CpC,OAAOc,IAAP,CAAYkD,OAAZ,CAAoBC,KAAlE,GAA0E,GAA1E,GAAgF/B,aAA9H,EAA6IlC,OAAOc,IAAP,CAAYkD,OAAZ,CAAoBG,IAAjK,EAAuKL,OAAvK,EAAgL,EAACM,QAAQ,IAAT,EAAhL,EAAgM,UAASxC,GAAT,EAAcyC,MAAd,EAAqB;AACnNpE,eAAS,YAAU;AACjB,YAAG,CAAC2B,GAAJ,EAAS;AACP5B,iBAAOE,QAAP,CAAgB6D,aAAhB,GAAgC,EAAhC;AACA/D,iBAAOE,QAAP,CAAgBE,UAAhB,GAA6B,UAA7B;AACAH,mBAAS,YAAU;AACjBD,mBAAOE,QAAP,CAAgBE,UAAhB,GAA6B,cAA7B;AACD,WAFD,EAEG,IAFH;AAGD,SAND,MAMO;AACLyB,gBAAM,mDAAN,EAA2D,CAAED,GAA7D;AACD;AACF,OAVD;AAWD,KAZD;AAaD,GA5CD;;AA8CA5B,SAAOsE,MAAP,GAAgB,YAAW;AACzB/D,qBAAiBgE,kBAAjB;AACAvE,WAAOyC,oBAAP,GAA8B,IAA9B;AACAzC,WAAO0C,oBAAP,GAA8B,IAA9B;AACA1C,WAAOiC,iBAAP,GAA2B,IAA3B;AACAjC,WAAOmC,iBAAP,GAA2B,IAA3B;AACAnC,WAAO2C,YAAP,GAAsB,IAAtB;AACA3C,WAAOe,KAAP,GAAe,IAAf;AACAf,WAAOiB,KAAP,GAAe,IAAf;AACD,GATD;;AAWAV,mBAAiBiE,OAAjB,CAAyB,WAAzB,EAAsC,MAAtC,EAA8C7D,aAA9C;AAGD,C;;AAGH;;;AACAb,SAAS2E,WAAT,GAAuB,IAAvB;;AAEA7E,QAAQC,MAAR,CAAe,KAAf,EAAsB6E,UAAtB,CAAiC,UAAjC,EAA6C5E,QAA7C","file":"app.js","sourcesContent":["'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    $scope.formData = {loading: true, pushStatus: \"Push Changes\"};\n\n    var permissions = [\n      {\n        name: \"stream-context-item\"\n      }\n    ]\n\n    let componentManager = new window.ComponentManager(permissions, function(){\n      $scope.formData.loading = false;\n      $scope.onReady();\n    });\n\n    let defaultHeight = 50;\n\n    componentManager.streamContextItem(function(item){\n      $timeout(function(){\n        $scope.note = item;\n        if($scope.repos) {\n          $scope.loadRepoDataForCurrentNote();\n        }\n      })\n    })\n\n    $scope.onReady = function() {\n      $scope.token = componentManager.componentDataValueForKey(\"token\");\n      if($scope.token) {\n        $scope.onTokenSet();\n      }\n    }\n\n    $scope.submitToken = function() {\n      $scope.token = $scope.formData.token;\n      componentManager.setComponentDataValueForKey(\"token\", $scope.token);\n      $scope.onTokenSet();\n    }\n\n    $scope.onTokenSet = function() {\n\n      $scope.gh = new GitHub({\n        token: $scope.token\n      });\n\n      var me = $scope.gh.getUser();\n      $scope.formData.loadingRepos = true;\n\n      me.listRepos(function(err, repos) {\n        $timeout(function(){\n          $scope.formData.loadingRepos = false;\n          if(err) {\n            alert(\"An error occurred with the GitHub Push extension. Make sure your GitHub token is valid and try again.\")\n            return;\n          }\n          $scope.repos = repos;\n          if($scope.note) {\n            $scope.loadRepoDataForCurrentNote();\n          }\n        })\n      });\n    }\n\n    $scope.loadRepoDataForCurrentNote = function() {\n      var noteData = componentManager.componentDataValueForKey(\"notes\") || {};\n      var savedNote = noteData[$scope.note.uuid];\n      if(savedNote) {\n        // per note preference\n        $scope.noteFileExtension = savedNote.fileExtension;\n        $scope.noteFileDirectory = savedNote.fileDirectory;\n        $scope.selectRepoWithName(savedNote.repoName);\n      } else {\n        // default pref\n        var defaultRepo = componentManager.componentDataValueForKey(\"defaultRepo\");\n        if(defaultRepo) {\n          $scope.formData.hasDefaultRepo = true;\n          $scope.selectRepoWithName(defaultRepo);\n        }\n      }\n\n      $scope.defaultFileExtension = componentManager.componentDataValueForKey(\"defaultFileExtension\");\n      $scope.formData.fileExtension = $scope.noteFileExtension || $scope.defaultFileExtension || \"txt\";\n      \n      $scope.defaultFileDirectory = componentManager.componentDataValueForKey(\"defaultFileDirectory\");\n      $scope.formData.fileDirectory = $scope.noteFileDirectory || $scope.defaultFileDirectory || \"\";\n    }\n\n\n    $scope.selectRepoWithName = function(name) {\n      $scope.formData.selectedRepo = $scope.repos.filter(function(repo){\n        return repo.name === name;\n      })[0];\n      $scope.didSelectRepo();\n    }\n\n    $scope.didSelectRepo = function() {\n      var repo = $scope.formData.selectedRepo;\n      $scope.selectedRepoObject = $scope.gh.getRepo(repo.owner.login, repo.name);\n\n      // save this as default repo for this note\n      $scope.setDataForNote(\"repoName\", repo.name);\n\n      // save this as default repo globally\n      if(!$scope.formData.hasDefaultRepo) {\n        componentManager.setComponentDataValueForKey(\"defaultRepo\", repo.name);\n      }\n    }\n\n    $scope.setDataForNote = function(key, value) {\n      var notesData = componentManager.componentDataValueForKey(\"notes\") || {};\n      var noteData = notesData[$scope.note.uuid] || {};\n      noteData[key] = value;\n      notesData[$scope.note.uuid] = noteData;\n      componentManager.setComponentDataValueForKey(\"notes\", notesData);\n    }\n\n    $scope.sanitizeFileDirectory = function($directory) {\n      // if no directory is given, then push to root.\n      if (!$directory)\n        return '';\n      \n      // try to ensure they haven't attempted any funny business with escape strings by turning\n      // any backslashes into forward slashes - then replace any duplicate slashes with a single\n      // slash.\n      return $directory = $directory\n        // make sure the last symbol is a '/'\n        .replace(/[/]*$/g, '/')\n        // make sure there are no escaping slashes.\n        .replace(/\\\\/g, '/')\n        // make sure there are no double '//'.\n        .replace(/\\/\\//g, '/')\n        // make sure the directory does not start with\n        // a '/'.\n        .replace(/^\\/+/g, '');\n    }\n\n    $scope.pushChanges = function($event) {\n      $event.target.blur();\n      var message = $scope.formData.commitMessage || `Updated note '${$scope.note.content.title}'`;\n\n      var fileExtension = $scope.formData.fileExtension;\n      var fileDirectory = $scope.formData.fileDirectory;\n      if(!$scope.defaultFileExtension) {\n        // set this as default\n        componentManager.setComponentDataValueForKey(\"defaultFileExtension\", fileExtension);\n        $scope.defaultFileExtension = fileExtension;\n      }\n\n      if(fileExtension !== $scope.noteFileExtension) {\n        // set this ext for this note\n        $scope.setDataForNote(\"fileExtension\", fileExtension);\n        $scope.noteFileExtension = fileExtension;\n      }\n\n      if(!$scope.defaultFileDirectory) {\n        // set this as default\n        componentManager.setComponentDataValueForKey(\"defaultFileDirectory\", fileDirectory);\n        $scope.defaultFileDirectory = fileDirectory;\n      }\n\n      if(fileDirectory !== $scope.noteFileDirectory) {\n        // set this directory for the note\n        $scope.setDataForNote(\"fileDirectory\", fileDirectory);\n        $scope.noteFileDirectory = fileDirectory;\n      }\n\n      $scope.formData.pushStatus = \"Pushing...\";\n      $scope.selectedRepoObject.writeFile(\"master\", $scope.sanitizeFileDirectory(fileDirectory) + $scope.note.content.title + \".\" + fileExtension, $scope.note.content.text, message, {encode: true}, function(err, result){\n        $timeout(function(){\n          if(!err) {\n            $scope.formData.commitMessage = \"\";\n            $scope.formData.pushStatus = \"Success!\";\n            $timeout(function(){\n              $scope.formData.pushStatus = \"Push Changes\";\n            }, 1500)\n          } else {\n            alert(\"Something went wrong trying to push your changes.\", + err);\n          }\n        })\n      });\n    }\n\n    $scope.logout = function() {\n      componentManager.clearComponentData();\n      $scope.defaultFileExtension = null;\n      $scope.defaultFileDirectory = null;\n      $scope.noteFileExtension = null;\n      $scope.noteFileDirectory = null;\n      $scope.selectedRepo = null;\n      $scope.repos = null;\n      $scope.token = null;\n    }\n\n    componentManager.setSize(\"container\", \"100%\", defaultHeight);\n\n\n  }\n}\n\n// required for FireFox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n"]}